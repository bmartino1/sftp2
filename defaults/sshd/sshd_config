# Secure defaults
# See: https://stribika.github.io/2015/01/04/secure-secure-shell.html

#openssh port used inside the docker default set to 22 if changed, this needs to be the same in fail2ban configs!...
Port 22

Protocol 2
HostKey /config/sshd/keys/ssh_host_ed25519_key
HostKey /config/sshd/keys/ssh_host_rsa_key

#Recommended, but Optional Set Ciphers ssh uses:
#KexAlgorithms curve25519-sha256,curve25519-sha256@libssh.org
#Ciphers aes256-gcm@openssh.com,chacha20-poly1305@openssh.com
#MACs hmac-sha2-512,hmac-sha2-256

# Host Key Algorithms (Optional: Ensure older clients can connect)
#HostKeyAlgorithms ssh-ed25519,rsa-sha2-512,rsa-sha2-256

# Optional Key Authentication only no users accounts only machine ssh keys...
# Disable password authentication (use keys only)
#PasswordAuthentication no
#PubkeyAuthentication yes
# Enable public key authentication
#AuthorizedKeysFile %h/.ssh/authorized_keys
#AuthorizedKeysFile /config/userkeys

# Login Grace and Timeouts
LoginGraceTime 0
# Allow 30 seconds to authenticate (CVE FIX)

MaxAuthTries 2
# Limit failed login attempts

#MaxSessions 2
# Restrict concurrent sessions

#
# Connection Settings
#

# Faster connection
# See: https://github.com/atmoz/sftp/issues/11
UseDNS no

# Limit access (No shells, no tunnels, no forwards... just sftp)
PermitRootLogin no
X11Forwarding no
AllowTcpForwarding no
GatewayPorts no
PermitTunnel no
AllowAgentForwarding no

#
# SFTP and Chroot Jail
#

# Force sftp and chroot jail
Subsystem sftp internal-sftp
ForceCommand internal-sftp
ChrootDirectory %h

# Logging
#SyslogFacility AUTH
#LogLevel INFO

# Detailed logging for debugging and log monitoring
# Make sure sshd sends logs to syslog, and include useful events:
SyslogFacility AUTHPRIV
LogLevel VERBOSE
#This shows connection info, key fingerprints, disconnects, etc.

# Fail2ban SFTP server with logging data:
# Use internal-sftp and log to AUTHPRIV at INFO level so it lands in /var/log/auth.log
Subsystem sftp internal-sftp -f AUTHPRIV -l INFO

#
# Additional Security Options
#

#ClientAliveInterval 300
# Disconnect idle clients after 5 minutes

#ClientAliveCountMax 2
# Allow two keep-alive messages before disconnection

#AllowUsers admin
# Restrict access to specific users (modify as needed)

# Explicitly deny root login and unsecure known user login
DenyUsers root guest anonymous
# Deny common user hacker login users and attempts (# comment above and uncomment below...)
#DenyUsers root NOUSER nousers ftphome guest anonymous ftp

